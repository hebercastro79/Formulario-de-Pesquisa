<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesquisa: Geração de Perguntas sobre o Mercado de Ações</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
        :root { --primary-color: #003366; --light-gray: #f4f4f9; --dark-gray: #333; --border-color: #ddd; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--light-gray); color: var(--dark-gray); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }
        .form-container { width: 100%; max-width: 800px; }
        .page-header { display: flex; justify-content: space-between; align-items: center; padding: 0 10px; margin-bottom: 20px; }
        .logo { max-height: 70px; width: auto; }
        main { background-color: white; padding: 30px 40px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        h1, h2 { font-weight: 700; color: var(--primary-color); text-align: center; margin-bottom: 30px; }
        .section-intro { text-align: center; margin-bottom: 30px; font-style: italic; color: #555; line-height: 1.6; }
        .question-block { margin-bottom: 30px; }
        .question-block > p, .consent-title { font-weight: 600; margin-bottom: 10px; }
        .options label, .checkbox-label { display: flex; align-items: center; margin-bottom: 10px; cursor: pointer; padding: 12px 15px; border: 1px solid var(--border-color); border-radius: 8px; transition: all 0.2s ease; }
        .options label:hover, .checkbox-label:hover { background-color: #f0f3f8; }
        .options label span { margin-left: 12px; flex-grow: 1; }
        input[type="radio"], input[type="checkbox"] { margin-right: 12px; transform: scale(1.1); flex-shrink: 0; }
        input[type="text"], input[type="email"] { width: 100%; box-sizing: border-box; padding: 12px; border-radius: 8px; border: 1px solid var(--border-color); font-family: 'Poppins', sans-serif; font-size: 1rem; }
        button { display: block; width: 100%; padding: 15px; background-color: var(--primary-color); color: white; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: background-color 0.2s ease; margin-top: 20px; }
        button:hover { background-color: #004b8d; }
        button:disabled { background-color: #aaa; cursor: not-allowed; }
        #profile-section, #task-section { display: none; }
        .consent-text { max-height: 300px; overflow-y: auto; border: 1px solid var(--border-color); padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; font-size: 0.9rem; text-align: justify; line-height: 1.7; }
        .consent-text p, .consent-text li { margin-bottom: 1em; }
        .consent-text ol { padding-left: 20px; }
        .consent-text ul li { list-style-type: '- '; }
        #example-questions-container { background-color: var(--light-gray); padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        #example-questions-container h3 { margin-top: 0; font-size: 1.1rem; }
        #example-questions-list { padding-left: 20px; margin-top: 15px; }
        #example-questions-list li { margin-bottom: 8px; }
        .custom-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .custom-modal { background: white; padding: 0; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); width: 90%; max-width: 400px; text-align: center; animation: modal-fade-in 0.3s ease; }
        .modal-header { background-color: var(--primary-color); color: white; padding: 15px 20px; border-top-left-radius: 10px; border-top-right-radius: 10px; }
        .modal-header h3 { margin: 0; font-size: 1.2rem; }
        .modal-body { padding: 25px 20px; font-size: 1rem; line-height: 1.6; }
        .modal-footer { padding: 15px 20px; border-top: 1px solid var(--border-color); }
        .modal-footer button { display: inline-block; width: auto; padding: 10px 30px; margin: 0; background-color: var(--primary-color); }
        @keyframes modal-fade-in { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .question-input-area { display: flex; gap: 10px; margin-bottom: 15px; }
        .question-input-area input { flex-grow: 1; }
        .question-input-area button { width: auto; margin-top: 0; padding: 12px 20px; }
        #question-counter-status { text-align: center; font-weight: 600; color: var(--primary-color); margin-bottom: 20px; }
        #user-questions-list-container { border: 1px solid var(--border-color); padding: 15px; border-radius: 8px; min-height: 100px; background-color: #fafafa; }
        #user-questions-list-container h4 { margin-top: 0; }
        #user-questions-list { padding-left: 20px; }
    </style>
</head>
<body>
    <div id="custom-alert-overlay" class="custom-modal-overlay">
        <div class="custom-modal">
            <div class="modal-header"><h3 id="modal-title">Alerta</h3></div>
            <div class="modal-body"><p id="modal-message">Mensagem de exemplo.</p></div>
            <div class="modal-footer"><button id="modal-close-btn">OK</button></div>
        </div>
    </div>

    <div class="form-container">
		<header class="page-header">
			<img src="./logo-ffclrp.png" alt="Logotipo da FFCLRP-USP" class="logo">
			<img src="./logo-ppgca.png" alt="Logotipo do PPG-CA" class="logo">
		</header>
		
        <main>
            <h1>Plataforma de Pesquisa</h1>
            <form id="research-form" novalidate>
                <section id="gate-section"></section>
                <section id="profile-section"></section>
                <section id="task-section"></section>
            </form>
        </main>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzyZ_AZEFvPh3o34hiMxAjDMWTcMb9whREcpT345CeLYdrwrwq6QIXzGsQ9rgJiTFFX-Q/exec';

        function showAlert(message, title = 'Alerta') {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            document.getElementById('custom-alert-overlay').style.display = 'flex';
        }
        document.getElementById('modal-close-btn').addEventListener('click', () => { document.getElementById('custom-alert-overlay').style.display = 'none'; });
        
        const gateSection = document.getElementById('gate-section');
        const profileSection = document.getElementById('profile-section');
        const taskSection = document.getElementById('task-section');
        const researchForm = document.getElementById('research-form');
        
        // --- INÍCIO DA SEÇÃO MODIFICADA ---
        const fixedExampleQuestions = [
            "Qual foi o preço de fechamento da ação preferencial da Braskem em 11/06/2025?",
            "Qual o setor de atuação da Bradesco?",
            "Quais as 2 ações de maior variação percentual no pregão de 30/06/2025?",
            "Qual foi a quantidade de negócios da ação com a maior baixa percentual em 18/06/2025?",
            "Qual foi a quantidade de negócios da ação com a maior alta percentual no SMLL em 10/06/2025?"
        ];
        
        document.addEventListener('DOMContentLoaded', () => {
            setupGateSection();
            setupProfileSection();
            researchForm.addEventListener('submit', submitForm);
        });

        function setupGateSection() {
            gateSection.innerHTML = `<h2>Consentimento para Participação</h2><p class="section-intro">Por favor, preencha as informações abaixo e leia o Termo de Consentimento para continuar.</p><div class="question-block"><p>Seu Nome Completo:</p><input type="text" id="user-name" name="user-name" required></div><div class="question-block"><p>Seu E-mail:</p><input type="email" id="user-email" name="user-email" required></div><div class="question-block"><p class="consent-title">TERMO DE CONSENTIMENTO LIVRE E ESCLARECIDO</p><div class="consent-text"><p><strong>PROJETO: Geração de consultas SPARQL a partir de linguagem natural</strong></p><p>Você está sendo convidado(a) a participar do projeto de pesquisa acima citado. O documento abaixo contém todas as informações necessárias sobre a pesquisa que estamos fazendo. Sua colaboração nesse estudo será de muita importância para nós.</p><p>Eu, ______________________________________________, abaixo assinado, concordo de livre e espontânea vontade em participar do estudo “Geração de consultas SPARQL a partir de linguagem natural”, e esclareço que obtive todas as informações.</p><p>Estou ciente de que:</p><ol>
            <li>O estudo faz parte de um projeto de mestrado do Programa de Pós-Graduação em Computação Aplicada (PPG-CA) da Faculdade de Filosofia, Ciências e Letras de Ribeirão Preto (FFCLRP) da Universidade de São Paulo e tem por objetivo propor uma abordagem para a tradução de perguntas realizadas em linguagem natural (português) para consultas SPARQL, bem como desenvolver uma ferramenta de suporte (Natural2SPARQL) para essa transformação.</li>
            <li>Como parte da metodologia do projeto, minha participação será organizada em duas etapas principais. Na primeira, responderei a uma pergunta sobre meus conhecimentos prévios a respeito do mercado de ações da bolsa de valores brasileira, a B3. Em seguida, serei exposto a um conjunto de cinco exemplos de perguntas — duas simples, duas intermediárias e uma complexa —, a partir do qual terei como tarefa elaborar entre 10 e 20 novas perguntas em linguagem natural (português). Essas perguntas não poderão ser idênticas aos exemplos apresentados e deverão estar estritamente relacionadas ao domínio da negociação de ações na B3, com foco específico no período de junho de 2025.<br><br>É fundamental que as perguntas se restrinjam a dados quantitativos e a eventos observáveis diretamente no pregão. Assim, devem contemplar informações como:<ul><li>Nomes de empresas (e.g., Vale, Petrobras) e seus respectivos códigos de negociação (tickers), como VALE3, PETR4 e TAEE11;</li><li>Setores de atuação das empresas (e.g., Siderurgia, Bancos, Transporte);</li><li>Índices da B3 (e.g., Ibovespa - IBOV, Financeiro - IFNC, Materiais Básicos - IMAT);</li><li>Tipos de ações (e.g., Ordinárias - ON, Preferenciais - PN e Units);</li><li>Métricas diárias de negociação (e.g., preços de abertura e fechamento, preços máximos e mínimos, volume negociado).</li></ul>Nesse sentido, reconheço que não devo formular perguntas sobre outros aspectos do universo financeiro ou corporativo das empresas listadas. Devem ser evitados, por exemplo: análises fundamentadas em balanços patrimoniais ou demonstrativos de resultados (DRE); questões ligadas à governança corporativa ou à composição acionária; temas relacionados a políticas de distribuição de proventos (como dividendos e juros sobre capital próprio – JCP); recomendações de analistas e preços-alvo; bem como notícias e fatos relevantes que não estejam diretamente vinculados às transações realizadas no período em análise.</li>
            <li>A pesquisa não envolve a coleta de dados pessoais dos participantes, apenas informações básicas sobre o conhecimento do participante do funcionamento do mercado de ações/B3 e o conjunto de perguntas propostas. Os resultados obtidos durante essa pesquisa serão mantidos em sigilo. Somente pessoas que fazem parte da equipe da pesquisa poderão ter acesso aos seus registros para acompanhar a pesquisa e analisar os dados obtidos, de acordo com as normas brasileiras que os protegem. Os resultados obtidos somente poderão ser divulgados de forma anônima em publicações científicas produzidas como decorrência do projeto, incluindo a própria dissertação de mestrado tema do projeto.</li>
            <li>Caso desejar, poderei tomar conhecimento dos resultados ao final desta pesquisa.</li>
            </ol><p>Ribeirão Preto, ......... de ..................... de 2025</p><hr><p>No caso de haver dúvidas sobre esse estudo, você poderá consultar:</p><p><strong>Pesquisador Responsável: Heber Gustavo Xavier de Castro</strong><br>Programa de Pós-Graduação em Computação Aplicada (PPG-CA)<br>Departamento de Computação e Matemática (DCM/FFCLRP/USP)<br>Av. Bandeirantes, 3900 – CEP 14040-901 – Ribeirão Preto (SP)<br>E-mail:  heber.castro@usp.br</p><p><strong>Orientador do Pesquisador Responsável: Prof. Dr. Cléver Ricardo Guareis de Farias</strong><br>Departamento de Computação e Matemática (DCM/FFCLRP/USP)<br>Av. Bandeirantes, 3900 – CEP 14040-901 – Ribeirão Preto (SP)<br>Fone: (16) 3315-0564<br>E-mail: farias@ffclrp.usp.br</p><p>Para denúncias e/ou reclamações referentes aos aspectos éticos da pesquisa, entrar em contato com:</p><p><strong>Comitê de Ética em Pesquisa (CEP) da FFCLRP USP</strong><br>Av. Bandeirantes, 3900 - Bloco 23 - Casa 37 - 14040-901 - Ribeirão Preto (SP)<br>Fone: (16) 3315-4811 / Fax: (16) 3633-2660<br>E-mail: coetp@ffclrp.usp.br / homepage: http://www.ffclrp.usp.br</p></div><div class="question-block" style="margin-bottom: 10px;"><label class="checkbox-label"><input type="checkbox" id="age-check" name="age-check"> Declaro que sou maior de 18 anos.</label></div><label class="checkbox-label"><input type="checkbox" id="consent-check" name="consent-check"> Concordo em participar. O ato de preencher o questionário contido neste formulário indica minha concordância na participação na pesquisa.</label></div><button type="button" id="proceed-btn">Prosseguir para a Pesquisa</button>`;
            document.getElementById('proceed-btn').addEventListener('click', proceedToProfile);
        }
        
        function setupProfileSection() {
             profileSection.innerHTML = `
                <h2>Perfil do Participante</h2>
                <p class="section-intro">Por favor, responda à pergunta abaixo para que possamos contextualizar suas respostas.</p>
                <div class="question-block">
                    <p>Como você classificaria seu conhecimento geral sobre a Bolsa de Valores (B3)?</p>
                    <div class="options">
                        <label>
                            <input type="radio" name="knowledge" value="1" required>
                            <span><strong>Pouco ou nenhum conhecimento:</strong><br>Não possui experiência prática em compra ou venda de ações na B3 e tem conhecimento limitado ou nulo sobre o funcionamento do mercado acionário.</span>
                        </label>
                        <label>
                            <input type="radio" name="knowledge" value="2">
                            <span><strong>Conhecimento intermediário:</strong><br>Já realizou algumas operações de compra e venda de ações na B3 ou acompanha o mercado com certa frequência, possuindo noções básicas sobre indicadores, preços e setores, mas sem prática contínua ou aprofundada.</span>
                        </label>
                        <label>
                            <input type="radio" name="knowledge" value="3">
                            <span><strong>Conhecimento avançado:</strong><br>Opera regularmente na B3 ou já acumulou experiência consistente em negociações, compreendendo em detalhe o funcionamento do pregão, métricas de negociação e características de diferentes ações e índices.</span>
                        </label>
                    </div>
                </div>
                <button type="button" id="start-task-btn">Iniciar Tarefa</button>`;
             document.getElementById('start-task-btn').addEventListener('click', startTask);
        }
        
        function proceedToProfile() {
            if (!document.getElementById('user-name').value.trim()) { showAlert('Por favor, preencha seu nome.'); return; }
            const email = document.getElementById('user-email').value.trim();
            if (!email) { showAlert('Por favor, preencha seu e-mail.'); return; }
            if (!document.getElementById('age-check').checked) { showAlert('Você deve declarar ser maior de 18 anos para participar.'); return; }
            if (!document.getElementById('consent-check').checked) { showAlert('É necessário concordar com o Termo para participar.'); return; }

            const proceedBtn = document.getElementById('proceed-btn');
            proceedBtn.disabled = true;
            proceedBtn.textContent = 'Verificando...';

            const payload = { action: 'checkEmail', email: email };

            fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify(payload),
                headers: { 'Content-Type': 'application/json' }
            })
            .then(response => {
                if (!response.ok) { throw new Error('A resposta da rede não foi "ok"'); }
                return response.json();
            })
            .then(data => {
                if (data.status === 'found') {
                    showAlert('Este e-mail já foi utilizado para responder à pesquisa. Agradecemos seu interesse, mas cada participante só pode enviar respostas uma vez.', 'Participação Duplicada');
                } else {
                    gateSection.style.display = 'none';
                    profileSection.style.display = 'block';
                }
            })
            .catch(error => {
                console.error('Erro na verificação de e-mail:', error);
                showAlert('Não foi possível verificar o e-mail. Por favor, verifique sua conexão com a internet e tente novamente.', 'Erro de Rede');
            })
            .finally(() => {
                proceedBtn.disabled = false;
                proceedBtn.textContent = 'Prosseguir para a Pesquisa';
            });
        }

        let questionCount = 0;

        function startTask() {
            const knowledgeInput = profileSection.querySelector('input[name="knowledge"]:checked');
            if (!knowledgeInput) { showAlert('Por favor, responda a pergunta do perfil para continuar.'); return; }
            
            // --- INÍCIO DA SEÇÃO MODIFICADA ---
            const numExamplesToShow = fixedExampleQuestions.length;

            taskSection.innerHTML = `<h2>Tarefa Principal</h2><div id="example-questions-container"><h3>A seguir, apresentamos ${numExamplesToShow} exemplos de perguntas. Estes são meros exemplos, <strong>evite copiá-los</strong>.</h3><ol id="example-questions-list"></ol></div><div class="question-block"><p>Por favor, elabore de 10 a 20 perguntas, uma de cada vez:</p><div class="question-input-area"><input type="text" id="new-question-input" placeholder="Digite uma pergunta aqui..."><button type="button" id="add-question-btn">Adicionar Pergunta</button></div><p id="question-counter-status"></p></div><div id="user-questions-list-container"><h4>Suas Perguntas Adicionadas:</h4><ol id="user-questions-list"></ol></div><button type="submit" id="final-submit-btn" disabled>Enviar Respostas</button>`;
            
            const exampleList = taskSection.querySelector('#example-questions-list');
            fixedExampleQuestions.forEach(q => { const li = document.createElement('li'); li.textContent = q; exampleList.appendChild(li); });
            // --- FIM DA SEÇÃO MODIFICADA ---
            
            document.getElementById('add-question-btn').addEventListener('click', addQuestionToList);
            
            questionCount = 0;
            updateQuestionUI();
            profileSection.style.display = 'none';
            taskSection.style.display = 'block';
        }

        function addQuestionToList() {
            const input = document.getElementById('new-question-input');
            const questionText = input.value.trim();
            if (!questionText) { showAlert('Por favor, digite uma pergunta antes de adicionar.'); return; }
            const list = document.getElementById('user-questions-list');
            const li = document.createElement('li');
            li.textContent = questionText;
            list.appendChild(li);
            input.value = '';
            input.focus();
            questionCount++;
            updateQuestionUI();
        }
        
        function updateQuestionUI() {
            const statusEl = document.getElementById('question-counter-status');
            const finalSubmitBtn = document.getElementById('final-submit-btn');
            const addQuestionBtn = document.getElementById('add-question-btn');
            const newQuestionInput = document.getElementById('new-question-input');
            if (questionCount < 10) { statusEl.textContent = `${questionCount} de 20 perguntas adicionadas. (Mínimo de 10 para enviar)`; finalSubmitBtn.disabled = true;
            } else if (questionCount >= 10 && questionCount < 20) { statusEl.textContent = `${questionCount} de 20 perguntas adicionadas. Você já pode enviar ou adicionar mais.`; finalSubmitBtn.disabled = false;
            } else if (questionCount >= 20) { statusEl.textContent = `Máximo de 20 perguntas atingido. Por favor, envie suas respostas.`; finalSubmitBtn.disabled = false; addQuestionBtn.disabled = true; newQuestionInput.disabled = true; newQuestionInput.placeholder = 'Máximo de perguntas alcançado.'; }
        }
        
        function submitForm(event) {
            event.preventDefault();
            const questionsList = document.querySelectorAll('#user-questions-list li');
            if (questionsList.length < 10) { showAlert('Você precisa adicionar no mínimo 10 perguntas para poder enviar.'); return; }

            const userGeneratedQuestionsArray = Array.from(questionsList).map(li => li.textContent);
            
            const finalData = {
                action: 'submitData',
                name: document.getElementById('user-name').value,
                email: document.getElementById('user-email').value,
                profile: { knowledge: profileSection.querySelector('input[name="knowledge"]:checked').value },
                userGeneratedQuestions: userGeneratedQuestionsArray.join('\n')
            };

            const submitButton = document.getElementById('final-submit-btn');
            if (submitButton) { submitButton.disabled = true; submitButton.textContent = 'Enviando...'; }
            
            fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify(finalData),
                headers: { 'Content-Type': 'application/json' }
            })
            .then(response => {
                if (!response.ok) { throw new Error('A resposta da rede não foi "ok"'); }
                return response.json();
            })
            .then(data => {
                if (data.result === 'success') {
                    showAlert('Obrigado pela sua participação! Suas respostas foram enviadas com sucesso.', 'Sucesso');
                    researchForm.reset();
                    gateSection.innerHTML = ''; profileSection.innerHTML = ''; taskSection.innerHTML = '';
                    setupGateSection(); setupProfileSection();
                    gateSection.style.display = 'block';
                    profileSection.style.display = 'none'; taskSection.style.display = 'none';
                } else {
                    throw new Error(data.error || 'Ocorreu um erro desconhecido no servidor.');
                }
            })
            .catch(error => {
                console.error('Erro ao enviar dados:', error);
                showAlert('Ocorreu um erro ao enviar suas respostas. Verifique sua conexão e tente novamente.', 'Erro no Envio');
            })
            .finally(() => {
                const finalBtn = document.getElementById('final-submit-btn');
                if(finalBtn) { finalBtn.disabled = false; finalBtn.textContent = 'Enviar Respostas'; }
            });
        }
    </script>
</body>
</html>