<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesquisa: Geração de Perguntas sobre o Mercado de Ações</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
        :root { --primary-color: #003366; --light-gray: #f4f4f9; --dark-gray: #333; --border-color: #ddd; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--light-gray); color: var(--dark-gray); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }
        .form-container { width: 100%; max-width: 800px; }
        .page-header { display: flex; justify-content: space-between; align-items: center; padding: 0 10px; margin-bottom: 20px; }
        .logo { max-height: 70px; width: auto; }
        main { background-color: white; padding: 30px 40px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        h1, h2 { font-weight: 700; color: var(--primary-color); text-align: center; margin-bottom: 30px; }
        .section-intro { text-align: center; margin-bottom: 30px; font-style: italic; color: #555; line-height: 1.6; }
        .question-block { margin-bottom: 30px; }
        .question-block > p, .consent-title { font-weight: 600; margin-bottom: 10px; }
        .options label, .checkbox-label { display: flex; align-items: center; margin-bottom: 10px; cursor: pointer; padding: 12px 15px; border: 1px solid var(--border-color); border-radius: 8px; transition: all 0.2s ease; }
        .options label:hover, .checkbox-label:hover { background-color: #f0f3f8; }
        input[type="radio"], input[type="checkbox"] { margin-right: 12px; transform: scale(1.1); }
        input[type="text"], input[type="email"] { width: 100%; box-sizing: border-box; padding: 12px; border-radius: 8px; border: 1px solid var(--border-color); font-family: 'Poppins', sans-serif; font-size: 1rem; }
        button { display: block; width: 100%; padding: 15px; background-color: var(--primary-color); color: white; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: background-color 0.2s ease; margin-top: 20px; }
        button:hover { background-color: #004b8d; }
        button:disabled { background-color: #aaa; cursor: not-allowed; }
        #context-section, #profile-section, #task-section { display: none; }
        .consent-text, .context-box { max-height: 300px; overflow-y: auto; border: 1px solid var(--border-color); padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; font-size: 0.9rem; text-align: justify; line-height: 1.7; }
        .context-box h3 { text-align: center; margin-top: 0; color: var(--primary-color); }
        .consent-text p, .consent-text li, .context-box p, .context-box li { margin-bottom: 1em; }
        .consent-text ol, .context-box ul { padding-left: 20px; }
        #example-questions-container { background-color: var(--light-gray); padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        #example-questions-container h3 { margin-top: 0; font-size: 1.1rem; }
        #example-questions-list { padding-left: 20px; margin-top: 15px; }
        #example-questions-list li { margin-bottom: 8px; }
        .custom-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .custom-modal { background: white; padding: 0; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); width: 90%; max-width: 400px; text-align: center; animation: modal-fade-in 0.3s ease; }
        .modal-header { background-color: var(--primary-color); color: white; padding: 15px 20px; border-top-left-radius: 10px; border-top-right-radius: 10px; }
        .modal-header h3 { margin: 0; font-size: 1.2rem; }
        .modal-body { padding: 25px 20px; font-size: 1rem; line-height: 1.6; }
        .modal-footer { padding: 15px 20px; border-top: 1px solid var(--border-color); }
        .modal-footer button { display: inline-block; width: auto; padding: 10px 30px; margin: 0; background-color: var(--primary-color); }
        @keyframes modal-fade-in { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .question-input-area { display: flex; gap: 10px; margin-bottom: 15px; }
        .question-input-area input { flex-grow: 1; }
        .question-input-area button { width: auto; margin-top: 0; padding: 12px 20px; }
        #question-counter-status { text-align: center; font-weight: 600; color: var(--primary-color); margin-bottom: 20px; }
        #user-questions-list-container { border: 1px solid var(--border-color); padding: 15px; border-radius: 8px; min-height: 100px; background-color: #fafafa; }
        #user-questions-list-container h4 { margin-top: 0; }
        #user-questions-list { padding-left: 20px; }
    </style>
</head>
<body>
    <div id="custom-alert-overlay" class="custom-modal-overlay">
        <div class="custom-modal">
            <div class="modal-header"><h3 id="modal-title">Alerta</h3></div>
            <div class="modal-body"><p id="modal-message">Mensagem de exemplo.</p></div>
            <div class="modal-footer"><button id="modal-close-btn">OK</button></div>
        </div>
    </div>

    <div class="form-container">
		<header class="page-header">
			<img src="./logo-ffclrp.png" alt="Logotipo da FFCLRP-USP" class="logo">
			<img src="./logo-ppgca.png" alt="Logotipo do PPG-CA" class="logo">
		</header>
		
        <main>
            <h1>Plataforma de Pesquisa</h1>
            <form id="research-form" novalidate>
                <section id="gate-section"></section>
                <section id="context-section"></section>
                <section id="profile-section"></section>
                <section id="task-section"></section>
            </form>
        </main>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxT_-9qEPQcWrzZkZarSrqJIMY7kQ-Nu55wvZbd6dFzkOf84OyW-17WJz3XzDjXz98nLg/exec';

        function showAlert(message, title = 'Alerta') {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            document.getElementById('custom-alert-overlay').style.display = 'flex';
        }
        document.getElementById('modal-close-btn').addEventListener('click', () => { document.getElementById('custom-alert-overlay').style.display = 'none'; });
        
        const gateSection = document.getElementById('gate-section');
        const contextSection = document.getElementById('context-section');
        const profileSection = document.getElementById('profile-section');
        const taskSection = document.getElementById('task-section');
        const researchForm = document.getElementById('research-form');
        
        // --- INÍCIO DA SEÇÃO MODIFICADA ---
        const simpleQuestions = ["Qual foi o preço de fechamento da ação da Vale em 18/06/2025?", "Qual foi o preço de abertura da ação da Ambev em 25/06/2025?", "Qual foi o preço máximo da ação da Localiza em 11/06/2025?", "Qual foi o preço mínimo da ação da Suzano em 13/06/2025?", "Qual foi o preço médio da ação da Braskem em 20/06/2025?", "Qual foi o preço de fechamento da WEGE3 em 27/06/2025?", "Qual foi o preço de abertura da VALE3 em 11/06/2025?", "Qual foi o preço máximo da PETR4 em 12/06/2025?", "Qual foi o preço mínimo da GGBR3 em 20/06/2025?", "Qual foi o preço médio da MGLU3 em 24/06/2025?", "Qual o código de negociação da ação da Petrobras?", "Qual o ticker da ação da Azul?", "Qual o código de negociação da ação da BTG Pactual?", "Qual o símbolo da ação da Embraer?", "Qual o código de negociação da ação da BB Seguridade?", "Qual o ticker da ação da Magazine Luiza?", "Qual o símbolo da ação da Weg?", "Qual o ticker da ação da Braskem?", "Qual o código de negociação da ação da Klabin?", "Qual o símbolo da ação da Itausa?", "Quais são as ações do setor de bancos?", "Quais são os tickers do setor de telecomunicações?", "Quais são as ações do setor de papel e celulose?", "Quais são os tickers do setor de mineração?", "Quais são as ações do setor de tecnologia da informação?", "Quais são as empresas do setor de transporte?", "Quais são as empresas do setor financeiro?", "Quais são as empresas do setor de bebidas?", "Quais são as empresas do setor de consumo cíclico?", "Quais são as empresas do setor de materiais básicos?"];
        const intermediateQuestions = ["Qual foi o volume negociado nas ações do setor de mineração em 20/06/2025?", "Qual foi o volume negociado no setor de saúde em 18/06/2025?", "Qual foi a soma da quantidade de negócios no setor de siderurgia em 30/06/2025?", "Qual foi o volume total das ações do setor de consumo não cíclico em 27/06/2025?", "Qual foi a soma do volume das ações do setor de telecomunicações em 13/06/2025?", "Qual foi a soma da quantidade de negócios no setor de bebidas em 30/06/2025?", "Qual foi o volume negociado nas ações do setor de energia elétrica em 20/06/2025?", "Qual foi a soma da quantidade de negócios no setor de saúde em 30/06/2025?", "Qual foi a soma da quantidade de negócios no setor de transporte em 18/06/2025?", "Qual foi o volume negociado nas ações do setor de bancos em 20/06/2025?", "Qual foi o preço máximo da ação ordinária da Vale em 30/06/2025?", "Qual foi o preço de fechamento da ação preferencial da Braskem em 18/06/2025?", "Qual foi o preço mínimo da ação ordinária da Usiminas em 24/06/2025?", "Qual foi o preço de abertura da ação preferencial da Klabin em 25/06/2025?", "Qual foi o preço médio da ação ordinária da Petrobras em 26/06/2025?", "Qual foi o preço máximo da ação TAEE11 em 30/06/2025?", "Qual foi o preço mínimo da ação ordinária da Embraer em 10/06/2025?", "Qual foi o preço médio da ação preferencial do Bradesco em 13/06/2025?", "Qual foi o preço de fechamento da ação ordinária da Magazine Luiza em 18/06/2025?", "Qual foi o preço de abertura da ação preferencial da Gerdau em 27/06/2025?", "Qual foi a variação percentual da ação da Azul em 11/06/2025?", "Qual foi a variação em reais da ação da Localiza em 30/06/2025?", "Qual foi a variação absoluta da ação da Ambev em 25/06/2025?", "Qual foi a variação percentual da Usiminas em 20/06/2025?", "Qual foi a variação intradiária absoluta da ação da Raia Drogasil em 10/06/2025?", "Qual foi a variação em reais da ação da Vale em 26/06/2025?", "Qual foi a variação percentual da ação da Embraer em 12/06/2025?", "Qual foi a variação percentual da ação da BB Seguridade em 13/06/2025?", "Qual foi a variação absoluta da ação da Weg em 24/06/2025?", "Qual foi a variação intradiária absoluta da ação da Bradesco em 30/06/2025?", "Quais as três ações de maior alta percentual em 13/06/2025?", "Quais as cinco ações de menor variação em reais no pregão de 12/06/2025?", "Quais a ação com maior alta variação percentual em 27/06/2025?", "Qual o papel de menor variação percentual em 18/06/2025?", "Quais as duas ações de maior intervalo intradiário percentual em 30/06/2025?", "Qual a ação do setor de siderurgia com a maior alta percentual em 20/06/2025?", "Qual a ação do setor de telecomunicações com a maior baixa percentual em 25/06/2025?", "Qual a ação do setor de energia eletrica com o maior alta percentual em 11/06/2025?", "Qual a ação do setor de bancos com a menor variação percentual em 24/06/2025?", "Qual a ação do setor de saúde com o maior intervalo intradiário absoluto em 30/06/2025?"];
        const complexQuestions = ["Qual foi o preço de fechamento da ação com a menor variação percentual em 12/06/2025?", "Qual foi o volume da ação com a menor variação em reais em 20/06/2025?", "Qual foi o preço de abertura da ação com o maior intervalo absoluto em 27/06/2025?", "Qual foi o preço médio da ação com a maior alta percentual em 18/06/2025?", "Qual foi o preço mínimo da ação com a menor variação percentual em 30/06/2025?", "Qual foi o volume da ação com a maior alta percentual entre as ações do IBOV em 30/06/2025?", "Qual foi o preço de fechamento da ação com a menor variação percentual entre as ações do IEE em 25/06/2025?", "Qual foi o intervalo intradiário percentual da ação com a maior queda em reais entre as ações do IMAT em 18/06/2025?", "Qual foi a quantidade de negócios da ação com a maior alta percentual entre as ações do IFNC em 30/06/2025?", "Qual foi o preço máximo da ação com a maior variação absoluta entre as ações do SMLL em 13/06/2025?"];
        // --- FIM DA SEÇÃO MODIFICADA ---
        
        function shuffleArray(array) { 
            for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } return array; 
        }

        document.addEventListener('DOMContentLoaded', () => {
            setupGateSection();
            setupContextSection();
            setupProfileSection();
            researchForm.addEventListener('submit', submitForm);
        });

        function setupGateSection() {
            gateSection.innerHTML = `<h2>Consentimento para Participação</h2><p class="section-intro">Por favor, preencha as informações abaixo e leia o Termo de Consentimento para continuar.</p><div class="question-block"><p>Seu Nome Completo:</p><input type="text" id="user-name" name="user-name" required></div><div class="question-block"><p>Seu E-mail:</p><input type="email" id="user-email" name="user-email" required></div><div class="question-block"><p class="consent-title">TERMO DE CONSENTIMENTO LIVRE E ESCLARECIDO</p><div class="consent-text"><p><strong>PROJETO: Geração de consultas SPARQL a partir de linguagem natural</strong></p><p>Você está sendo convidado(a) a participar do projeto de pesquisa acima citado. O documento abaixo contém todas as informações necessárias sobre a pesquisa que estamos fazendo. Sua colaboração nesse estudo será de muita importância para nós.</p><p>Eu, ______________________________________________, abaixo assinado, concordo de livre e espontânea vontade em participar do estudo “Geração de consultas SPARQL a partir de linguagem natural”, e esclareço que obtive todas as informações.</p><p>Estou ciente de que:</p><ol>
            <li>O estudo faz parte de um projeto de mestrado do Programa de Pós-Graduação em Computação Aplicada (PPG-CA) da Faculdade de Filosofia, Ciências e Letras de Ribeirão Preto (FFCLRP) da Universidade de São Paulo e tem por objetivo propor uma abordagem para a tradução de perguntas realizadas em linguagem natural (português) para consultas SPARQL, bem como desenvolver uma ferramenta de suporte (Natural2SPARQL) para essa transformação.</li>
            <li>Como parte da metodologia do projeto, minha participação consistirá em duas etapas principais. Na primeira, você será consultado sobre seus conhecimentos prévios sobre o mercado de ações da bolsa de valores brasileira, a B3. Logo após, será apresentado a você um conjunto de 8 exemplos de perguntas (quatro simples, três intermediárias e uma complexa) e sua tarefa será elaborar um conjunto de 10 a 20 novas perguntas em linguagem natural (português), que não sejam iguais aos exemplos, e estritamente relacionadas ao domínio de negociação de ações na B3, com foco específico no período de junho de 2025.
            <br><br>É crucial que as questões se atenham a dados quantitativos e eventos observáveis diretamente no pregão. Os temas devem girar em torno dos índices de negociação da B3 (como Ibovespa e IFIX), das empresas listadas e seus respectivos tickers de negociação (ex: PETR4, VALE3) ou de setores de atuação (ex: setor bancário, setor de varejo). As perguntas devem focar em métricas como preços de abertura, fechamento, máxima e mínima do dia, volume financeiro negociado ou variações percentuais.
            <br><br>Desta forma, não deverão ser formuladas perguntas que abordem outros aspectos do universo financeiro ou corporativo das empresas listadas. Exemplos de tópicos a serem evitados incluem: análise de fundamentos da empresa, como balanços patrimoniais e demonstrativos de resultados (DRE); governança corporativa e composição acionária; políticas de distribuição de proventos, como dividendos e juros sobre capital próprio (JCP); recomendações de analistas e seus preços-alvo; ou notícias e fatos relevantes que não estejam diretamente ligados a uma transação específica no período delimitado.
            <br><br>Finalmente, as questões elaboradas serão utilizadas pela equipe de pesquisa para avaliar a capacidade de tradução da abordagem/ferramenta Natural2SPARQL.</li>
            <li>A pesquisa não envolve a coleta de dados pessoais dos participantes, apenas informações básicas sobre o conhecimento do participante do funcionamento do mercado de ações/B3 e o conjunto de perguntas propostas. Os resultados obtidos durante essa pesquisa serão mantidos em sigilo. Somente pessoas que fazem parte da equipe da pesquisa poderão ter acesso aos seus registros para acompanhar a pesquisa e analisar os dados obtidos, de acordo com as normas brasileiras que os protegem. Os resultados obtidos somente poderão ser divulgados de forma anônima em publicações científicas produzidas como decorrência do projeto, incluindo a própria dissertação de mestrado tema do projeto.</li>
            <li>Caso desejar, poderei tomar conhecimento dos resultados ao final desta pesquisa.</li>
            </ol><p>Ribeirão Preto, ......... de ..................... de 2025</p><hr><p>No caso de haver dúvidas sobre esse estudo, você poderá consultar:</p><p><strong>Pesquisador Responsável: Heber Gustavo Xavier de Castro</strong><br>Programa de Pós-Graduação em Computação Aplicada (PPG-CA)<br>Departamento de Computação e Matemática (DCM/FFCLRP/USP)<br>Av. Bandeirantes, 3900 – CEP 14040-901 – Ribeirão Preto (SP)<br>E-mail:  heber.castro@usp.br</p><p><strong>Orientador do Pesquisador Responsável: Prof. Dr. Cléver Ricardo Guareis de Farias</strong><br>Departamento de Computação e Matemática (DCM/FFCLRP/USP)<br>Av. Bandeirantes, 3900 – CEP 14040-901 – Ribeirão Preto (SP)<br>Fone: (16) 3315-0564<br>E-mail: farias@ffclrp.usp.br</p><p>Para denúncias e/ou reclamações referentes aos aspectos éticos da pesquisa, entrar em contato com:</p><p><strong>Comitê de Ética em Pesquisa (CEP) da FFCLRP USP</strong><br>Av. Bandeirantes, 3900 - Bloco 23 - Casa 37 - 14040-901 - Ribeirão Preto (SP)<br>Fone: (16) 3315-4811 / Fax: (16) 3633-2660<br>E-mail: coetp@ffclrp.usp.br / homepage: http://www.ffclrp.usp.br</p></div><div class="question-block" style="margin-bottom: 10px;"><label class="checkbox-label"><input type="checkbox" id="age-check" name="age-check"> Declaro que sou maior de 18 anos.</label></div><label class="checkbox-label"><input type="checkbox" id="consent-check" name="consent-check"> Concordo em participar. O ato de preencher o questionário contido neste formulário indica minha concordância na participação na pesquisa.</label></div><button type="button" id="proceed-btn">Prosseguir para a Pesquisa</button>`;
            document.getElementById('proceed-btn').addEventListener('click', proceedToProfile);
        }

        function setupContextSection() {
            contextSection.innerHTML = `<h2 class="sr-only" style="display:none;">Contexto da Pesquisa</h2><div class="context-box"><h3>Sobre os Dados Utilizados</h3><p>Obrigado por sua colaboração! O objetivo desta pesquisa é testar uma ferramenta que traduz perguntas em português para uma linguagem de consulta de dados chamada SPARQL. Para isso, criamos uma <strong>base de dados simulada, mas realista, sobre o mercado de ações brasileiro (B3)</strong>, focada exclusivamente nas negociações do <strong>mês de junho de 2025</strong>.</p><p>Sua tarefa será formular perguntas que poderiam ser respondidas utilizando <strong>APENAS</strong> os seguintes tipos de informação:</p><ul><li><strong>Métricas Diárias de Ações:</strong> Preços de abertura, fechamento, máximo e mínimo, além do volume financeiro negociado para cada ação em um determinado dia.</li><li><strong>Informações das Empresas:</strong> Nomes de empresas (ex: Vale, Petrobras) e seus códigos de negociação (tickers, ex: VALE3, PETR4).</li><li><strong>Categorias de Mercado:</strong> Setores de atuação (ex: Siderurgia, Bancos, Transporte) e os principais Índices da B3 (ex: Ibovespa - IBOV, Financeiro - IFNC, Materiais Básicos - IMAT).</li><li><strong>Tipos de Ações:</strong> Diferenciação entre ações Ordinárias (ON), Preferenciais (PN) e Units.</li></ul><p><strong>É muito importante que suas perguntas se limitem a este universo.</strong> Por favor, <strong>EVITE</strong> perguntas sobre tópicos que <strong>NÃO</strong> estão em nossa base de dados, como:</p><ul><li>Análises financeiras (balanços, DRE, lucros).</li><li>Governança corporativa ou acionistas.</li><li>Dividendos, JCP ou outros proventos.</li><li>Recomendações de analistas ou notícias de mercado.</li></ul></div><button type="button" id="proceed-to-profile-btn">Entendido, ir para o Perfil</button>`;
            document.getElementById('proceed-to-profile-btn').addEventListener('click', () => {
                contextSection.style.display = 'none';
                profileSection.style.display = 'block';
            });
        }
        
        // --- INÍCIO DA SEÇÃO MODIFICADA ---
        function setupProfileSection() {
             profileSection.innerHTML = `
                <h2>Perfil do Participante</h2>
                <p class="section-intro">Agora, para nos ajudar a analisar os dados, por favor, responda a uma única pergunta sobre seu perfil.</p>
                <div class="question-block">
                    <p>Como você classificaria seu conhecimento geral sobre a Bolsa de Valores (B3)?</p>
                    <div class="options">
                        <label><input type="radio" name="knowledge" value="1" required> 1 - Não tenho conhecimento, nunca tive contato com o mercado da Bolsa de Valores</label>
                        <label><input type="radio" name="knowledge" value="2"> 2 - Tenho conhecimento intermediário ou limitado sobre o mercado da Bolsa de Valores</label>
                        <label><input type="radio" name="knowledge" value="3"> 3 - Tenho conhecimento avançado no mercado da Bolsa de Valores</label>
                    </div>
                </div>
                <button type="button" id="start-task-btn">Iniciar Tarefa</button>`;
             document.getElementById('start-task-btn').addEventListener('click', startTask);
        }
        // --- FIM DA SEÇÃO MODIFICADA ---

        function proceedToProfile() {
            if (!document.getElementById('user-name').value.trim()) { showAlert('Por favor, preencha seu nome.'); return; }
            const email = document.getElementById('user-email').value.trim();
            if (!email) { showAlert('Por favor, preencha seu e-mail.'); return; }
            if (!document.getElementById('age-check').checked) { showAlert('Você deve declarar ser maior de 18 anos para participar.'); return; }
            if (!document.getElementById('consent-check').checked) { showAlert('É necessário concordar com o Termo para participar.'); return; }

            const proceedBtn = document.getElementById('proceed-btn');
            proceedBtn.disabled = true;
            proceedBtn.textContent = 'Verificando...';

            window.handleEmailCheckResponse = function(response) {
                if (response.status === 'found') {
                    showAlert('Este e-mail já foi utilizado para responder à pesquisa. Agradecemos seu interesse, mas cada participante só pode enviar respostas uma vez.', 'Participação Duplicada');
                } else {
                    gateSection.style.display = 'none';
                    contextSection.style.display = 'block';
                }
                const scriptTag = document.getElementById('jsonp-script');
                if (scriptTag) scriptTag.remove();
                proceedBtn.disabled = false;
                proceedBtn.textContent = 'Prosseguir para a Pesquisa';
            };

            const script = document.createElement('script');
            script.id = 'jsonp-script';
            script.src = `${SCRIPT_URL}?action=checkEmail&email=${encodeURIComponent(email)}&callback=handleEmailCheckResponse`;
            script.onerror = function() {
                showAlert('Não foi possível verificar o e-mail. Por favor, verifique sua conexão com a internet e tente novamente.', 'Erro de Rede');
                proceedBtn.disabled = false;
                proceedBtn.textContent = 'Prosseguir para a Pesquisa';
            };
            document.body.appendChild(script);
        }

        let questionCount = 0;

        function startTask() {
            const knowledgeInput = profileSection.querySelector('input[name="knowledge"]:checked');
            if (!knowledgeInput) {
                showAlert('Por favor, responda a pergunta do perfil para continuar.');
                return;
            }
            
            const shuffledSimple = shuffleArray([...simpleQuestions]);
            const shuffledIntermediate = shuffleArray([...intermediateQuestions]);
            const shuffledComplex = shuffleArray([...complexQuestions]);

            const selectedExamples = [
                ...shuffledSimple.slice(0, 4),
                ...shuffledIntermediate.slice(0, 3),
                ...shuffledComplex.slice(0, 1)
            ];
            
            const finalShuffledExamples = shuffleArray(selectedExamples);
            const numExamplesToShow = finalShuffledExamples.length;

            taskSection.innerHTML = `<h2>Tarefa Principal</h2><div id="example-questions-container"><h3>A seguir, apresentamos ${numExamplesToShow} exemplos de perguntas. Estes são meros exemplos, <strong>evite copiá-los</strong>.</h3><ol id="example-questions-list"></ol></div><div class="question-block"><p>Por favor, elabore de 10 a 20 perguntas, uma de cada vez:</p><div class="question-input-area"><input type="text" id="new-question-input" placeholder="Digite uma pergunta aqui..."><button type="button" id="add-question-btn">Adicionar Pergunta</button></div><p id="question-counter-status"></p></div><div id="user-questions-list-container"><h4>Suas Perguntas Adicionadas:</h4><ol id="user-questions-list"></ol></div><button type="submit" id="final-submit-btn" disabled>Enviar Respostas</button>`;
            
            const exampleList = taskSection.querySelector('#example-questions-list');
            finalShuffledExamples.forEach(q => { const li = document.createElement('li'); li.textContent = q; exampleList.appendChild(li); });
            
            document.getElementById('add-question-btn').addEventListener('click', addQuestionToList);
            
            questionCount = 0;
            updateQuestionUI();

            profileSection.style.display = 'none';
            taskSection.style.display = 'block';
        }

        function addQuestionToList() {
            const input = document.getElementById('new-question-input');
            const questionText = input.value.trim();
            if (!questionText) { showAlert('Por favor, digite uma pergunta antes de adicionar.'); return; }
            const list = document.getElementById('user-questions-list');
            const li = document.createElement('li');
            li.textContent = questionText;
            list.appendChild(li);
            input.value = '';
            input.focus();
            questionCount++;
            updateQuestionUI();
        }
        
        function updateQuestionUI() {
            const statusEl = document.getElementById('question-counter-status');
            const finalSubmitBtn = document.getElementById('final-submit-btn');
            const addQuestionBtn = document.getElementById('add-question-btn');
            const newQuestionInput = document.getElementById('new-question-input');
            if (questionCount < 10) {
                statusEl.textContent = `${questionCount} de 20 perguntas adicionadas. (Mínimo de 10 para enviar)`;
                finalSubmitBtn.disabled = true;
            } else if (questionCount >= 10 && questionCount < 20) {
                statusEl.textContent = `${questionCount} de 20 perguntas adicionadas. Você já pode enviar ou adicionar mais.`;
                finalSubmitBtn.disabled = false;
            } else if (questionCount >= 20) {
                statusEl.textContent = `Máximo de 20 perguntas atingido. Por favor, envie suas respostas.`;
                finalSubmitBtn.disabled = false;
                addQuestionBtn.disabled = true;
                newQuestionInput.disabled = true;
                newQuestionInput.placeholder = 'Máximo de perguntas alcançado.';
            }
        }
        
        function submitForm(event) {
            event.preventDefault();
            
            const questionsList = document.querySelectorAll('#user-questions-list li');
            if (questionsList.length < 10) {
                showAlert('Você precisa adicionar no mínimo 10 perguntas para poder enviar.');
                return;
            }

            const userGeneratedQuestionsArray = Array.from(questionsList).map(li => li.textContent);
            const userGeneratedQuestions = userGeneratedQuestionsArray.join('\n');

            const submitButton = document.getElementById('final-submit-btn');
            if (submitButton) {
                submitButton.disabled = true;
                submitButton.textContent = 'Enviando...';
            }

            const finalData = {
                name: document.getElementById('user-name').value,
                email: document.getElementById('user-email').value,
                profile: {
                    knowledge: profileSection.querySelector('input[name="knowledge"]:checked').value
                },
                userGeneratedQuestions: userGeneratedQuestions
            };
            
            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(finalData)
            })
            .then(() => {
                showAlert('Obrigado pela sua participação! Suas respostas foram enviadas com sucesso.', 'Sucesso');
                researchForm.reset();
                gateSection.innerHTML = '';
                contextSection.innerHTML = '';
                profileSection.innerHTML = '';
                taskSection.innerHTML = '';
                setupGateSection();
                setupContextSection();
                setupProfileSection();
                gateSection.style.display = 'block';
                contextSection.style.display = 'none';
                profileSection.style.display = 'none';
                taskSection.style.display = 'none';
            })
            .catch(error => {
                console.error('Erro ao enviar dados:', error);
                showAlert('Ocorreu um erro ao enviar suas respostas. Verifique sua conexão e tente novamente.', 'Erro no Envio');
            })
            .finally(() => {
                const finalBtn = document.getElementById('final-submit-btn');
                if(finalBtn) {
                    finalBtn.disabled = false;
                    finalBtn.textContent = 'Enviar Respostas';
                }
            });
        }
    </script>
</body>
</html>